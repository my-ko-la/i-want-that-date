<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://unpkg.com/sanitize.css" rel="stylesheet" />
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <script
            defer
            src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
        ></script>
    </head>
    <body class="flex items-center justify-center min-h-screen w-full bg-amber-500">
        <header class="fixed top-0 left-0 w-full bg-red-900 justify-center text-center text-white shadow z-50 px-4 py-2">
          Mykola really wants that date
        </header>
        <main x-data class="flex flex-col gap-24 justify-center items-center w-[300px]">
          <div
            x-text="$store.words.ita"
            class="bg-emerald-600 rounded-xl px-4 py-6 text-xl font-semibold shadow-md text-center truncate w-[300px]"
          ></div>

          <div id="options" class="flex flex-col gap-4 w-full">
            <template x-for="(entry, index) in $store.words.options" :key="index">
              <div
                x-text="entry.word"
                @click="$store.words.pick(entry)"
                class="cursor-pointer bg-yellow-200 rounded-lg px-4 py-3 text-lg font-medium shadow hover:bg-yellow-300 transition text-center truncate"
                :class="{
                  'bg-green-300': $store.words.status === 'correct' && entry.isCorrect,
                  'bg-red-300': $store.words.status === 'wrong' && entry.isCorrect === false
                }"
              ></div>
            </template>
          </div>
        </main>
    </body>

    <script>
        const data = [
            "testa",
            "head",
            "fronte",
            "forehead",
            "capelli",
            "hair",
            "occhio",
            "eye",
            "orecchio",
            "ear",
            "naso",
            "nose",
            "bocca",
            "mouth",
            "lingua",
            "tongue",
            "dente",
            "tooth",
            "mento",
            "chin",
            "guancia",
            "cheek",
            "collo",
            "neck",
            "spalla",
            "shoulder",
            "braccio",
            "arm",
            "gomito",
            "elbow",
            "mano",
            "hand",
            "dito",
            "finger",
            "unghia",
            "nail",
            "polso",
            "wrist",
            "petto",
            "chest",
            "schiena",
            "back",
            "pancia",
            "belly",
            "fianco",
            "side",
            "anca",
            "hip",
            "gamba",
            "leg",
            "ginocchio",
            "knee",
            "piede",
            "foot",
            "tallone",
            "heel",
            "caviglia",
            "ankle",
            "cuore",
            "heart",
            "pantagruelico",
            "gargantuan",
            "sgranchirsi",
            "to stretch oneself",
            "sbrodolarsi",
            "to slobber",
            "zuppicante",
            "soaking",
            "ciabattino",
            "cobbler",
            "zuzzurellone",
            "goofball",
            "gattabuia",
            "jail",
            "accipicchia",
            "gosh",
            "blaterare",
            "to babble",
            "sfrigolare",
            "to sizzle",
            "pappagorgia",
            "double chin",
            "cianciare",
            "to chatter",
            "sbadigliare",
            "to yawn",
            "strabuzzare",
            "to bulge",
            "gracchiare",
            "to caw",
            "pasticcio",
            "mess",
            "trabiccolo",
            "rickety vehicle",
            "infradiciare",
            "to soak",
            "smargiasso",
            "braggart",
            "pernacchia",
            "raspberry",
            "cianfrusaglia",
            "junk",
            "cicciobombo",
            "fatty-boom-boom",
            "accartocciarsi",
            "to crumple up",
            "tiritera",
            "refrain",
            "bisboccia",
            "revelry",
            "grattacapo",
            "headache",
            "triccheballacche",
            "rattle instruments",
            "gorgheggiare",
            "to warble",
            "scarabocchio",
            "scribble",
            "tarantolato",
            "possessed",
            "buongiorno",
            "good morning",
            "grazie",
            "thank you",
            "per favore",
            "please",
            "Amore",
            "love",
            "Buonasera",
            "good evening",
            "Cibo",
            "food",
            "forse",
            "maybe",
            "Calore",
            "warmth",
            "quando",
            "when",
            "dove",
            "where",
            "come",
            "how",
            "Fiore",
            "flower",
            "cosa",
            "what",
            "mai",
            "never",
            "sempre",
            "always",
            "adesso",
            "now",
            "presto",
            "soon",
            "tardi",
            "late",
            "oggi",
            "today",
            "domani",
            "tomorrow",
            "ieri",
            "yesterday",
            "fame",
            "hunger",
            "sete",
            "thirst",
            "aiuto",
            "help",
            "attento",
            "careful",
            "soldi",
            "money",
            "macchina",
            "car",
            "Casa",
            "home",
            "Mare",
            "sea",
            "Sole",
            "sun",
        ];

        function generateIndex(data) {
            return Math.floor(Math.random() * data.length + 1);
        }

        function isEven(number) {
            return number % 2 === 0;
        }

        function getRandomEnglishWord(data, oldIndex) {
            let newIndex = generateIndex(data);

            // make sure we don't fall on the same word
            while (isEven(newIndex) && newIndex !== oldIndex) {
                newIndex = generateIndex(data);
            }

            return data[newIndex];
        }

        function getMainPairOfWords(data) {
            let index = generateIndex(data);

            if (index % 2 !== 0) {
                index = index - 1;
            }

            return {
                ita: data[index].toLowerCase(),
                eng: data[index + 1].toLowerCase(),
                englishWordIndex: index,
            };
        }

        function getOtherWordTranslations(data, index) {
            return [
                getRandomEnglishWord(data, index),
                getRandomEnglishWord(data, index),
                getRandomEnglishWord(data, index),
            ];
        }

        const mainPair = getMainPairOfWords(data);
        const otherWords = getOtherWordTranslations(
            data,
            mainPair.englishWordIndex,
        );

      const allWords = [mainPair.eng, ...otherWords].sort(() => Math.random() - 0.5)


        function shuffle(array) {
          return array.sort(() => Math.random() - 0.5);
        }

        function buildShuffledOptions(correct, incorrects) {
          return shuffle([
            { word: correct, isCorrect: true },
            ...incorrects.map(w => ({ word: w, isCorrect: false }))
          ]);
        }

        const options = buildShuffledOptions(mainPair.eng, otherWords);

       document.addEventListener('alpine:init', () => {
        Alpine.store('words', {
          ita: mainPair.ita,
          options,
          status: null,
          pick(word) {
            this.status = word.isCorrect ? 'correct' : 'wrong';
            setTimeout(() => {
              const newMain = getMainPairOfWords(data);
              const newOthers = getOtherWordTranslations(data, newMain.englishWordIndex);
              this.ita = newMain.ita;
              this.options = buildShuffledOptions(newMain.eng, newOthers);
              this.status = null;
            }, 1000);
          }
        });
        })
    </script>
</html>
